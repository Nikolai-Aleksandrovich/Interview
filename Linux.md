# Linux笔记



## 一、Linux目录结构：

* linux文件采用级层目录结构，最上层是根目录/
* 在linux中，一切都是文件

1. 具体的目录结构：
   * /bin (/usr/bin、/usr/local/bin)	存放最经常使用的命令
   * /sbin(/usr/sbin /usr/local/sbin)   存放系统管理员的系统管理程序
   * /home 存放普通用户的主目录，每个用户都有一个自己的目录
   * /root  系统管理员的主目录
   * /lib  系统开机需要基本的动态连接共享库，类似于windows的DLL
   * /lost+found  系统异常关机，会存放文件
   * /etc 所有系统管理需要的配置文件和子目录，比如mysql的my.conf
   * /usr 用户的应用程序和文件都在本目录
   * /boot linux启动的核心文件，包括连接文件及镜像文件
   * /proc 虚拟目录，是系统内存的映射，访问以获取系统信息
   * /srv service的缩写，存放服务启动后要提取的数据
   * /sys 2.6内核的文件系统sysfs
   * /tmp 存放临时文件
   * /dev 把所有硬件用文件的形式存储
   * /media linux系统自动识别设备，并且把设备挂载到这个目录
   * /mnt 让用户挂载别的文件系统
   * /opt 给主机额外安装软件所存放的目录
   * /user/local 给主机额外安装软件的目录
   * /var 存放不断扩充的东西，放日志
   * /selinux linux的安全子系统，控制程序只能访问特定文件

# 二、磁盘是如何划分区的？

* 磁盘盘面可以细分为sector和track两种单位，sector的大小可能是512Bytes或者4KBytes

* 多个磁盘叠在一起，所有磁盘的同一个磁道称为磁柱Cylinder，是文件系统的最小单位，也是分区槽的最小单位，但对于GBT可以使用扇区sector作为最小分区单位，总结：利用参考对照Cylinder或者Sector

  ### MBR磁盘分区

  * 磁盘的第一个sector存储分区表（记录硬盘分区的状态，64bytes）和主要启动记录区（开机管理程序，446bytes），称为MBR
    * 因为分区表只有64bytes，只能有四组记录区，每组记录区存储这个区段的启动与结束的Cylinder号码
    * 分区只是针对64bytes的分区表进行设定
    * 硬盘的默认分区表仅能写入四组分区信息，称为主要或延申分区槽
    * 分区槽的最小单位为Cylinder磁柱
    * 系统写入时，先参考磁盘分区表，才能进行数据处理
  * 分区图啥呢？
    * 数据安全
    * 减少扫描磁柱
  * 可以使用延伸分区突破硬盘四个分区的限制：
    * 主要分区、延伸分区最多有四个（硬盘限制），延伸分区最多有一个（操作系统限制），逻辑分区是延伸分区切割出来的
    * 延伸分区的实现是：使用额外的扇区记录分区信息，本身不能格式化
    * 分区槽被称为逻辑分区槽
    * 逻辑分区槽在linux的文件名也会跳过1234，直接从5开始

  ### GPT磁盘分区

  * GPT将磁盘使用LBA（预设512bytes）进行规划，使用前34个LBA记录分区信息，使用最后33个LBA也记录分区信息，中间的区域进行分区划分，使用34个LBA区块

![image-20211101150159294](C:/Users/lenovo/AppData/Roaming/Typora/typora-user-images/image-20211101150159294.png)

* LBA0（MBR相容区块）

  这个区块分两部分，第一部分记录开机管理程序，第二部分放一个标识，表示当前按磁盘为GPT格式

* LBA1（GPT表头记录

  记录分区表本身的位置与大小、备份的GPT分区位置、分区表的校验码（CRC32）。

* LBA2-33（实际记录分区信息处）

  每个LBA可以纪律4个分区记录，所以最多可以有4*32 = 128个分区记录，每个分区记录使用128bytes的空间。记录开始与结束的扇区号码

* 每一个分区都是主分区，都可以用来格式化

###   开机流程中的BIOS和UEFI开机检测

* BIOS是写在主板上的FirmWare，每次开机第一个启动
* CMOS是记录硬件参数并且嵌入到主板的存储器

开机到操作系统之前的动作为：

* BIOS：开机主动执行的FirmWare
* MBR：第一个可开机装置的第一个扇区内的主要启动记录区域、或者来自GBT的的LBA0区域。
* 开机管理程序（boot loader）：可读取文件来执行的软件
* 核心文件：开始操作系统的功能

开机管理程序主要任务：

* 提供选单：用户选择不同的开机项目
* 载入核心文件：直接指向可开机的程序区段来开始操作系统
* 转交其他loader：将开机管理功能交给其他loader（因为多重引导的存在）

多重引导的过程：

![image-20211101164800163](C:/Users/lenovo/AppData/Roaming/Typora/typora-user-images/image-20211101164800163.png)

* 每个分区槽都有自己的启动扇区
* 实际开机的文件放在系统槽。loader只认识自己系统槽内的可开机核心文件，以及其他loader，loader可以把管理权交给同其他loader

### 挂载

所谓的『挂载』就是利用一个目录当成进入点，将磁盘分区槽的数据放置在该目录下； 也就是说， 进入该目录就可以读取该分区槽的意思。

